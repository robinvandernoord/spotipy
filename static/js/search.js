'use strict';var s=new SpotifyWebApi;s.setAccessToken(TOKEN);function block(a){$(a).block({message:'<i class="fa fa-check"></i>',css:{border:'0',backgroundColor:'none',color:'white',fontSize:200,cursor:'not-allowed'}})}function unblock(a){$(a).block({message:'<i class="fa fa-times"></i>',css:{border:'0',backgroundColor:'none',color:'white',fontSize:200,cursor:'not-allowed'},timeout:1e3})}function add_to_sidebar(a){var b=$('<a>');b.text(a),b.attr('href','?query='+escape(a)),$('#mySidenav .playlist').append(b)}async function get_playlist(a){var b=(await s.getPlaylistTracks(a)).items;return $('#mySidenav .playlist').empty(),b.forEach(function(a){return add_to_sidebar(a.track.name)}),b.map(function(a){return a.track.id})}async function search(a){var b=$('#results');b.empty();var c=await get_playlist(playlist_id),d=await s.searchTracks(a,{limit:6});d.tracks.items.forEach(async function(a){var d=a.name,e=(await s.getArtist(a.artists[0].id)).images[0].url,f=a.artists.map(function(a){return a.name}).join(', '),g=a.album.name,h=a.album.images[0].url,i=a.id,j=$('<div class=\'search-result-item column is-one-third\'>').loadTemplate('#spotify-result',{id:i,name:d,artists:f,artistImage:e,album:g,albumImage:h});j.on('click','.add-to-list',function(a){a.preventDefault(),$.post(POSTURL,{track_id:i})// todo: replace with pop-up notification
.then(function(a){return notify(a,'success')}).catch(function(a){notify(a.responseText,'danger'),unblock(j)}),block(j),add_to_sidebar(d)}),b.append(j),c.includes(i)&&block(j)})}$.urlParam=function(a){return new URL(window.location.href).searchParams.get(a)},$.setParam=function(a,b){history.pushState({id:''},'','?'+a+'='+b)},$(function(){$('#searchform').on('submit',function(){var a=$('#searchform #songname'),b=a.val();return b?(search(b),$.setParam('query',b),a.removeClass('is-danger'),a.addClass('is-success')):(a.removeClass('is-success'),a.addClass('is-danger')),!1});// autofill/search ?query= param
var a=$.urlParam('query');a&&(a=unescape(a),search(a),$('#searchform #songname').val(a))});
//# sourceMappingURL=search.js.map